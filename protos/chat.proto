syntax = "proto3";

package chat;

import "google/protobuf/timestamp.proto";

/// Chat Service
message Message {
  string id = 1;
  string sender = 2;
  string content = 3;
  google.protobuf.Timestamp created_at = 4;
}

service ChatService {
    rpc Connect(stream Message) returns (stream Message);
}

/// Auth Service
service AuthService {
  rpc Register(RegisterRequest) returns (AuthResponse);
  rpc Login(AuthRequest) returns (AuthResponse);
  rpc RefreshToken(RefreshTokenRequest) returns (AuthResponse);
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
  rpc Logout(LogoutRequest) returns (LogoutResponse);
}

message RegisterRequest {
  string username = 1;
  string password = 2;
  string email = 3;
  string display_name = 4;
}

message AuthRequest {
  string username = 1;
  string password = 2;
}

// 認證響應
message AuthResponse {
  string token = 1;
  string refresh_token = 2;
  int64 expires_at = 3;
  string user_id = 4;
  string username = 5;
  string display_name = 6;
  bool is_new_user = 7;    // 區分註冊和登入
}

// 登出請求
message LogoutRequest {
  string token = 1;
}

// 登出響應
message LogoutResponse {
  bool success = 1;
}

// 錯誤響應
message ErrorResponse {
  string code = 1;
  string message = 2;
  map<string, string> details = 3;
}

// 錯誤代碼
enum ErrorCode {
  UNKNOWN = 0;
  USERNAME_ALREADY_EXISTS = 1;
  INVALID_USERNAME_FORMAT = 2;
  WEAK_PASSWORD = 3;
  INVALID_EMAIL_FORMAT = 4;
  USER_NOT_FOUND = 5;
  INVALID_PASSWORD = 6;
  TOKEN_EXPIRED = 7;
  INVALID_TOKEN = 8;
}